# ローカルテストガイド

## 前提条件

1. Node.js 18+ がインストールされていること
2. Cloudflareアカウント（D1データベース用、オプション）
3. Google Books APIキー（オプション - 手動登録のみの場合は不要）

## セットアップ手順

### 1. 環境変数の設定

#### バックエンド
```bash
cd backend
cp .dev.vars.example .dev.vars
# .dev.varsを編集してGOOGLE_BOOKS_API_KEYを設定（オプション）
```

**注意**: Google Books APIキーがない場合でも、手動登録機能は動作します。

#### フロントエンド
```bash
cd frontend
# .envファイルは既に設定済み（VITE_API_URL=http://localhost:8787/api）
```

### 2. データベースのセットアップ（初回のみ）

```bash
cd backend

# ローカルD1データベースにスキーマを適用
npx wrangler d1 execute books-arika-db --local --file=./schema.sql
```

### 3. サーバーの起動

#### ターミナル1: バックエンド
```bash
cd backend
npm run dev
```

バックエンドは `http://localhost:8787` で起動します。

#### ターミナル2: フロントエンド
```bash
cd frontend
npm run dev
```

フロントエンドは `http://localhost:5173` で起動します。

## テスト手順

### 1. ヘルスチェック
ブラウザで `http://localhost:8787/health` にアクセスして、バックエンドが正常に動作していることを確認します。

### 2. フロントエンドの確認
ブラウザで `http://localhost:5173` にアクセスします。

### 3. 書籍登録のテスト

#### 方法1: キーワード検索（Google Books APIキーが必要）
1. 「書籍登録」ページに移動
2. 「検索」タブを選択
3. タイトルまたは著者名を入力して検索
4. 検索結果から書籍を選択
5. 「登録」ボタンをクリック

#### 方法2: 手動登録（APIキー不要）
1. 「書籍登録」ページに移動
2. 「手動登録」タブを選択
3. タイトルを入力（必須）
4. 著者、ISBNを入力（任意）
5. 「登録」ボタンをクリック

#### 方法3: バーコードスキャン（実装中）
1. 「書籍登録」ページに移動
2. 「バーコード」ボタンをクリック
3. カメラアクセスを許可（または手動でISBNを入力）

## トラブルシューティング

### バックエンドが起動しない
- `wrangler login` を実行してCloudflareにログイン
- `.dev.vars` ファイルが正しく設定されているか確認

### フロントエンドがバックエンドに接続できない
- バックエンドが `http://localhost:8787` で起動しているか確認
- CORSエラーが出る場合は、バックエンドのCORS設定を確認

### データベースエラー
- スキーマが適用されているか確認: `npx wrangler d1 execute books-arika-db --local --file=./schema.sql`
- ローカルデータベースの状態を確認: `npx wrangler d1 execute books-arika-db --local --command="SELECT * FROM books LIMIT 5"`

### Google Books APIエラー
- APIキーが正しく設定されているか確認
- 手動登録機能を使用してテストを続行可能

## テストシナリオ

### シナリオ1: 手動登録（基本機能）
1. 手動登録タブを選択
2. タイトル「テスト書籍」を入力
3. 著者「テスト著者」を入力
4. 登録ボタンをクリック
5. 成功メッセージが表示されることを確認

### シナリオ2: 重複検出
1. 上記のシナリオ1で登録した書籍と同じ情報で再度登録を試みる
2. 重複エラーメッセージが表示されることを確認

### シナリオ3: キーワード検索（APIキーがある場合）
1. 検索タブを選択
2. 「React」と入力して検索
3. 検索結果が表示されることを確認
4. 書籍を選択して登録


